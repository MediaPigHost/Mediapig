define(["require","exports","module","helpers","microAjax"],function(e,t,r,s){var n={init:function(){this.events()},events:function(){app.help.addEventListenerByClass("register-trigger","click",function(){app.publish("/event/register/submit",!0),app.ajax(window.location.origin+"/page/register",function(e){app.publish("/view/register/loaded",!0);var t=document.getElementById("overlay-content");t.innerHTML+=e,s.removeClass(t.parentNode,"overlay-loading")}),ga("send","event","click","register trigger")}),app.subscribe("/view/register/loaded",function(e){e===!0&&(n.postSignup(),app.help.addEventListenerByClass("help","click",function(e){app.help.showTooltip(e,"help-message")}))}),app.subscribe("/form/register/update",function(e){var t=document.getElementById("create-account-button");"success"===e?(app.help.loading(t,"success"),ga("send","event","action","register success"),setTimeout(function(){ga("send","event","loaded","order form"),app.publish("/view/order",!0)},2e3)):app.help.loading(t,"remove")})},postSignup:function(){var e=document.getElementById("signup");e.addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("create-account-button");app.help.loading(t);{var r=document.getElementById("signup");new FormData(r)}app.help.postForm(r,function(e){app.help.removeElementsByClass("error");var t=JSON.parse(e.response);t.errors?(app.publish("/form/register/update","fail"),app.publish("/message/error",t.errors)):(siteObj.orderConfig.user=t.customer_id,siteObj.orderConfig.door=t.key,app.help.setCookie("key",t.key,"1"),app.help.setCookie("user",t.customer_id,"1"),app.publish("/form/register/update","success"))})})}};r.exports=n});